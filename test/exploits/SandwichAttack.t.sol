// SPDX-License-Identifier: MIT
pragma solidity ^0.8.20;

import {Test, console} from "forge-std/Test.sol";
import {SimpleOracle} from "../../src/oracle/SimpleOracle.sol";
import {AccessManager} from "../../src/access/AccessManager.sol";

contract SandwichAttackTest is Test {
    SimpleOracle public oracle;
    AccessManager public accessManager;
    address public admin = makeAddr("admin");
    address public attacker = makeAddr("attacker");

    function setUp() public {
        vm.startPrank(admin);
        accessManager = new AccessManager(admin);
        oracle = new SimpleOracle(address(accessManager));
        vm.stopPrank();
    }

    function testSandwichAttack() public {
        uint256 initialPrice = oracle.getPrice();
        console.log("Initial Oracle Price:", initialPrice);

        vm.prank(attacker);
        oracle.updatePrice(0.5 ether);
        console.log("Attacker crashed price to:", oracle.getPrice());

        vm.prank(attacker);
        oracle.updatePrice(1.5 ether);
        console.log("Attacker pumped price to:", oracle.getPrice());

        assertEq(oracle.getPrice(), 1.5 ether);
    }
}
